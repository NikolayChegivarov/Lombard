{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block extrastyle %}
{{ block.super }}
<style>
.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
}

.update-container {
    max-width: 800px;
    margin: 40px auto;
    padding: 40px;
    background: #f8f9fa;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    border: 2px solid #ddd;
}

.update-container h1 {
    color: #343a40;
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 2px solid #dee2e6;
    text-align: center;
}

.current-prices, .new-prices {
    margin: 30px 0;
    padding: 20px;
    border-radius: 5px;
}

.current-prices {
    background: #e9ecef;
    border: 1px solid #ced4da;
}

.new-prices {
    background: #d4edda;
    border: 1px solid #c3e6cb;
}

.price-group {
    margin-bottom: 25px;
}

.price-group label {
    display: block;
    font-weight: bold;
    margin-bottom: 8px;
    color: #495057;
}

.price-group input {
    width: 100%;
    padding: 12px 15px;
    border: 2px solid #ddd;
    border-radius: 5px;
    font-size: 16px;
}

.price-group input:focus {
    border-color: #79aec8;
    outline: none;
    box-shadow: 0 0 0 3px rgba(121, 174, 200, 0.1);
}

.button-group {
    display: flex;
    gap: 15px;
    margin: 30px 0;
    justify-content: center;
}

.btn {
    padding: 12px 30px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
    font-weight: bold;
    transition: all 0.3s ease;
    min-width: 150px;
}

.btn-primary {
    background: #79aec8;
    color: white;
}

.btn-primary:hover {
    background: #609ab6;
    transform: translateY(-2px);
}

.btn-success {
    background: #5cb85c;
    color: white;
}

.btn-success:hover {
    background: #449d44;
    transform: translateY(-2px);
}

.btn-secondary {
    background: #6c757d;
    color: white;
}

.btn-secondary:hover {
    background: #545b62;
}

.price-table {
    width: 100%;
    border-collapse: collapse;
    margin: 20px 0;
    background: white;
    border: 1px solid #dee2e6;
    border-radius: 5px;
}

.price-table th, .price-table td {
    padding: 15px;
    text-align: left;
    border-bottom: 1px solid #dee2e6;
}

.price-table th {
    background: #79aec8;
    color: white;
    font-weight: bold;
}

.price-table tr:last-child td {
    border-bottom: none;
}

.current-price {
    color: #28a745;
    font-weight: bold;
}

.new-price-input {
    width: 100%;
    padding: 8px;
    border: 2px solid #007bff;
    border-radius: 4px;
    text-align: right;
    font-weight: bold;
}

.metal-section {
    margin: 30px 0;
    padding: 20px;
    border-radius: 5px;
}

.gold-section {
    background: #FFF9E6;
    border: 2px solid #FFD700;
}

.silver-section {
    background: #F8F9FA;
    border: 2px solid #C0C0C0;
}

.section-title {
    display: flex;
    align-items: center;
    margin-bottom: 20px;
    color: #343a40;
}

.gold-title {
    color: #B8860B;
}

.silver-title {
    color: #708090;
}

.price-row {
    display: grid;
    grid-template-columns: 150px 1fr 1fr;
    gap: 20px;
    align-items: center;
    padding: 10px 0;
    border-bottom: 1px solid rgba(0,0,0,0.1);
}

.price-row:last-child {
    border-bottom: none;
}

.calculated-value {
    color: #007bff;
    font-weight: bold;
    font-size: 16px;
    text-align: right;
    padding: 8px;
    background: #e7f3ff;
    border-radius: 4px;
}

.hidden-fields {
    display: none;
}

@media (max-width: 768px) {
    .update-container {
        padding: 20px;
        margin: 20px;
    }

    .price-row {
        grid-template-columns: 1fr;
        gap: 10px;
    }

    .btn {
        min-width: 120px;
        padding: 10px 20px;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="container">
    <div class="update-container">
        <h1>–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω –Ω–∞ –ø—Ä–æ–±—ã –º–µ—Ç–∞–ª–ª–æ–≤</h1>

        {% if messages %}
        <div style="margin: 20px 0;">
            {% for message in messages %}
            <div style="padding: 15px; border-radius: 5px; margin-bottom: 10px;
                {% if message.tags == 'success' %}background: #d4edda; color: #155724; border: 1px solid #c3e6cb;
                {% elif message.tags == 'error' %}background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb;
                {% else %}background: #fff3cd; color: #856404; border: 1px solid #ffeaa7;{% endif %}">
                {{ message }}
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <form method="post" id="priceForm">
            {% csrf_token %}

            <!-- –°–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π -->
            <div class="hidden-fields">
                <input type="hidden" id="calculated_375" value="{% if calculated_prices.gold_375 %}{{ calculated_prices.gold_375 }}{% endif %}">
                <input type="hidden" id="calculated_500" value="{% if calculated_prices.gold_500 %}{{ calculated_prices.gold_500 }}{% endif %}">
                <input type="hidden" id="calculated_585" value="{% if calculated_prices.gold_585 %}{{ calculated_prices.gold_585 }}{% endif %}">
                <input type="hidden" id="calculated_750" value="{% if calculated_prices.gold_750 %}{{ calculated_prices.gold_750 }}{% endif %}">
                <input type="hidden" id="calculated_850" value="{% if calculated_prices.gold_850 %}{{ calculated_prices.gold_850 }}{% endif %}">
            </div>

            <div class="current-prices">
                <h3>–¢–µ–∫—É—â–∏–µ —Ü–µ–Ω—ã:</h3>
                <div class="price-table">
                    <thead>
                        <tr>
                            <th>–ú–µ—Ç–∞–ª–ª</th>
                            <th>–ü—Ä–æ–±–∞</th>
                            <th>–¶–µ–Ω–∞ (—Ä—É–±./–≥)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- –ó–æ–ª–æ—Ç–æ -->
                        <tr>
                            <td rowspan="5">–ó–æ–ª–æ—Ç–æ</td>
                            <td>375</td>
                            <td class="current-price">{{ current_prices.gold_375|default:"‚Äî" }}</td>
                        </tr>
                        <tr>
                            <td>500</td>
                            <td class="current-price">{{ current_prices.gold_500|default:"‚Äî" }}</td>
                        </tr>
                        <tr>
                            <td>585</td>
                            <td class="current-price">{{ current_prices.gold_585|default:"‚Äî" }}</td>
                        </tr>
                        <tr>
                            <td>750</td>
                            <td class="current-price">{{ current_prices.gold_750|default:"‚Äî" }}</td>
                        </tr>
                        <tr>
                            <td>850</td>
                            <td class="current-price">{{ current_prices.gold_850|default:"‚Äî" }}</td>
                        </tr>
                        <!-- –°–µ—Ä–µ–±—Ä–æ -->
                        <tr>
                            <td>–°–µ—Ä–µ–±—Ä–æ</td>
                            <td>925</td>
                            <td class="current-price">{{ current_prices.silver_925|default:"‚Äî" }}</td>
                        </tr>
                    </tbody>
                </div>
            </div>

            <div class="metal-section gold-section">
                <div class="section-title gold-title">
                    <h3>–ù–æ–≤—ã–µ —Ü–µ–Ω—ã –Ω–∞ –∑–æ–ª–æ—Ç–æ:</h3>
                </div>

                <div class="price-group">
                    <label for="gold_585_price">–¶–µ–Ω–∞ –Ω–∞ –∑–æ–ª–æ—Ç–æ 585 –ø—Ä–æ–±—ã (—Ä—É–±./–≥):</label>
                    <input type="number"
                           id="gold_585_price"
                           name="gold_585_price"
                           step="0.01"
                           min="0"
                           value="{{ gold_585_price|default:'' }}"
                           required
                           placeholder="–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É">
                </div>

                <div style="margin-top: 20px;">
                    {% if show_results %}
                    <div style="background: #e7f3ff; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                        <p><strong>–†–∞—Å—á–∏—Ç–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:</strong></p>
                        <div class="price-row">
                            <span><strong>–ü—Ä–æ–±–∞ 375:</strong></span>
                            <div class="calculated-value">{{ calculated_prices.gold_375|floatformat:2 }}</div>
                            <span>—Ä—É–±./–≥</span>
                        </div>
                        <div class="price-row">
                            <span><strong>–ü—Ä–æ–±–∞ 500:</strong></span>
                            <div class="calculated-value">{{ calculated_prices.gold_500|floatformat:2 }}</div>
                            <span>—Ä—É–±./–≥</span>
                        </div>
                        <div class="price-row">
                            <span><strong>–ü—Ä–æ–±–∞ 585:</strong></span>
                            <div class="calculated-value">{{ calculated_prices.gold_585|floatformat:2 }}</div>
                            <span>—Ä—É–±./–≥</span>
                        </div>
                        <div class="price-row">
                            <span><strong>–ü—Ä–æ–±–∞ 750:</strong></span>
                            <div class="calculated-value">{{ calculated_prices.gold_750|floatformat:2 }}</div>
                            <span>—Ä—É–±./–≥</span>
                        </div>
                        <div class="price-row">
                            <span><strong>–ü—Ä–æ–±–∞ 850:</strong></span>
                            <div class="calculated-value">{{ calculated_prices.gold_850|floatformat:2 }}</div>
                            <span>—Ä—É–±./–≥</span>
                        </div>
                    </div>

                    <h4>–í—ã –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º:</h4>
                    {% endif %}

                    <!-- –ü–æ–ª—è –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
                    <div class="price-row">
                        <span><strong>–ü—Ä–æ–±–∞ 375:</strong></span>
                        <input type="number"
                               id="gold_375_price"
                               name="gold_375_price"
                               step="0.01"
                               min="0"
                               value="{% if show_results %}{{ calculated_prices.gold_375|floatformat:2 }}{% endif %}"
                               class="new-price-input"
                               placeholder="–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç"
                               data-required-for-save="true">
                        <span>—Ä—É–±./–≥</span>
                    </div>
                    <div class="price-row">
                        <span><strong>–ü—Ä–æ–±–∞ 500:</strong></span>
                        <input type="number"
                               id="gold_500_price"
                               name="gold_500_price"
                               step="0.01"
                               min="0"
                               value="{% if show_results %}{{ calculated_prices.gold_500|floatformat:2 }}{% endif %}"
                               class="new-price-input"
                               placeholder="–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç"
                               data-required-for-save="true">
                        <span>—Ä—É–±./–≥</span>
                    </div>
                    <div class="price-row">
                        <span><strong>–ü—Ä–æ–±–∞ 585:</strong></span>
                        <input type="number"
                               id="gold_585_price_field"
                               name="gold_585_price_field"
                               step="0.01"
                               min="0"
                               value="{% if show_results %}{{ calculated_prices.gold_585|floatformat:2 }}{% endif %}"
                               class="new-price-input"
                               placeholder="–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç"
                               readonly
                               data-required-for-save="true">
                        <span>—Ä—É–±./–≥</span>
                    </div>
                    <div class="price-row">
                        <span><strong>–ü—Ä–æ–±–∞ 750:</strong></span>
                        <input type="number"
                               id="gold_750_price"
                               name="gold_750_price"
                               step="0.01"
                               min="0"
                               value="{% if show_results %}{{ calculated_prices.gold_750|floatformat:2 }}{% endif %}"
                               class="new-price-input"
                               placeholder="–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç"
                               data-required-for-save="true">
                        <span>—Ä—É–±./–≥</span>
                    </div>
                    <div class="price-row">
                        <span><strong>–ü—Ä–æ–±–∞ 850:</strong></span>
                        <input type="number"
                               id="gold_850_price"
                               name="gold_850_price"
                               step="0.01"
                               min="0"
                               value="{% if show_results %}{{ calculated_prices.gold_850|floatformat:2 }}{% endif %}"
                               class="new-price-input"
                               placeholder="–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç"
                               data-required-for-save="true">
                        <span>—Ä—É–±./–≥</span>
                    </div>
                </div>
            </div>

            <div class="metal-section silver-section">
                <div class="section-title silver-title">
                    <h3>–ù–æ–≤–∞—è —Ü–µ–Ω–∞ –Ω–∞ —Å–µ—Ä–µ–±—Ä–æ:</h3>
                </div>

                <div class="price-group">
                    <label for="silver_925_price">–¶–µ–Ω–∞ –Ω–∞ —Å–µ—Ä–µ–±—Ä–æ 925 –ø—Ä–æ–±—ã (—Ä—É–±./–≥):</label>
                    <input type="number"
                           id="silver_925_price"
                           name="silver_925_price"
                           step="0.01"
                           min="0"
                           value="{{ silver_925_price|default:'' }}"
                           required
                           placeholder="–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É">
                </div>

                {% if show_results %}
                <div style="background: #e7f3ff; padding: 15px; border-radius: 5px; margin-top: 20px;">
                    <p><strong>–†–∞—Å—á–∏—Ç–∞–Ω–Ω–∞—è —Ü–µ–Ω–∞ –Ω–∞ —Å–µ—Ä–µ–±—Ä–æ:</strong></p>
                    <div style="text-align: center; font-size: 18px; font-weight: bold; color: #007bff;">
                        {{ calculated_prices.silver_925|floatformat:2 }} —Ä—É–±./–≥
                    </div>
                </div>
                {% endif %}
            </div>

            <div class="button-group">
                {% if not show_results %}
                <button type="submit" name="calculate" id="calculateBtn" class="btn btn-primary">
                    üî¢ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å
                </button>
                {% else %}
                <button type="submit" name="save" id="saveBtn" class="btn btn-success">
                    üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–æ–≤—ã–µ —Ü–µ–Ω—ã
                </button>
                <button type="submit" name="recalculate" class="btn btn-primary">
                    üîÑ –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å
                </button>
                {% endif %}

                <a href="../" class="btn btn-secondary">
                    ‚Ü© –ù–∞–∑–∞–¥
                </a>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extrajs %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('priceForm');
    const gold585Input = document.getElementById('gold_585_price');
    const calculateBtn = document.getElementById('calculateBtn');
    const saveBtn = document.getElementById('saveBtn');

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π
    function autoCalculateAndFill() {
        const price = parseFloat(gold585Input.value);
        if (!isNaN(price) && price > 0) {
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã
            const coefficients = {
                375: 375 / 585,
                500: 500 / 585,
                750: 750 / 585,
                850: 850 / 585
            };

            // –ó–∞–ø–æ–ª–Ω—è–µ–º –≤—Å–µ –ø–æ–ª—è —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
            for (const [sample, coeff] of Object.entries(coefficients)) {
                const input = document.getElementById(`gold_${sample}_price`);
                if (input) {
                    const calculated = (price * coeff).toFixed(2);
                    input.value = calculated;
                }
            }

            // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª–µ –¥–ª—è –ø—Ä–æ–±—ã 585
            const gold585Field = document.getElementById('gold_585_price_field');
            if (gold585Field) {
                gold585Field.value = price.toFixed(2);
            }

            return true;
        }
        return false;
    }

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ü–µ–Ω—ã 585
    if (gold585Input) {
        gold585Input.addEventListener('input', function() {
            // –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ, –∑–∞–ø–æ–ª–Ω—è–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
            const gold375 = document.getElementById('gold_375_price');
            if (!gold375.value) {
                autoCalculateAndFill();
            }
        });
    }

    // –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å —Ä–∞—Å—á–µ—Ç–∞–º–∏
    function autoFillOnLoad() {
        if (!gold585Input || !gold585Input.value) return;

        // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω–∏ –ø—É—Å—Ç—ã–µ
        const gold375 = document.getElementById('gold_375_price');
        if (gold375 && !gold375.value) {
            autoCalculateAndFill();
        }
    }

    // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    autoFillOnLoad();

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–†–∞—Å—Å—á–∏—Ç–∞—Ç—å"
    if (calculateBtn) {
        // –£–¥–∞–ª—è–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∏ –¥–æ–±–∞–≤–ª—è–µ–º —Å–≤–æ–µ
        form.addEventListener('submit', function(e) {
            if (e.submitter && e.submitter.name === 'calculate') {
                // –û—Ç–∫–ª—é—á–∞–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–ª—è –ø–æ–ª–µ–π —Å —Ü–µ–Ω–∞–º–∏
                const priceInputs = form.querySelectorAll('input[data-required-for-save="true"]');
                priceInputs.forEach(input => {
                    input.removeAttribute('required');
                });

                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
                if (!autoCalculateAndFill()) {
                    e.preventDefault();
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É –Ω–∞ –∑–æ–ª–æ—Ç–æ 585 –ø—Ä–æ–±—ã');
                    return false;
                }

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –ª–∏ –±–∞–∑–æ–≤—ã–µ –ø–æ–ª—è
                if (!gold585Input.value || !document.getElementById('silver_925_price').value) {
                    e.preventDefault();
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ —Ü–µ–Ω—ã –Ω–∞ –∑–æ–ª–æ—Ç–æ 585 –∏ —Å–µ—Ä–µ–±—Ä–æ 925');
                    return false;
                }
            }
        });
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"
    if (saveBtn) {
        form.addEventListener('submit', function(e) {
            if (e.submitter && e.submitter.name === 'save') {
                // –í–∫–ª—é—á–∞–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–ª—è –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–æ–ª–µ–π
                const priceInputs = form.querySelectorAll('input[data-required-for-save="true"]');
                priceInputs.forEach(input => {
                    input.setAttribute('required', 'required');
                });

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –ø–æ–ª—è
                let isValid = true;
                const requiredFields = [
                    'gold_585_price',
                    'silver_925_price',
                    'gold_375_price',
                    'gold_500_price',
                    'gold_585_price_field',
                    'gold_750_price',
                    'gold_850_price'
                ];

                for (const fieldName of requiredFields) {
                    const field = document.getElementById(fieldName) || document.querySelector(`[name="${fieldName}"]`);
                    if (field && !field.value) {
                        isValid = false;
                        field.style.borderColor = 'red';
                        setTimeout(() => {
                            field.style.borderColor = '';
                        }, 3000);
                    }
                }

                if (!isValid) {
                    e.preventDefault();
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                    return false;
                }
            }
        });
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å"
    form.addEventListener('submit', function(e) {
        if (e.submitter && e.submitter.name === 'recalculate') {
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ–º –≤—Å–µ –ø–æ–ª—è –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Å—á–µ—Ç–æ–º
            autoCalculateAndFill();
        }
    });
});
</script>
{% endblock %}